name: QA platform CI
on:
  workflow_call:
    inputs:
      service_name:
        required: true
        type: string
      dockerfile_path:
        required: true
        type: string
      itest_path: 
        required: true
        type: string
jobs:
  build-docker:
    runs-on: ubuntu-latest    
    steps:
      - name: getting source code
        uses: actions/checkout@v3
        with:
          path: app
      - name: getting itest framework libs
        run: docker run --rm -v $(pwd):/scripts mauroarias/share-qa-lib:latest /bin/cp -r /share-libs/ /scripts/
      - name: building service
        run: docker build -t ${{ inputs.service_name }}:test .
        working-directory: app/${{ inputs.dockerfile_path }}
      - name: copy itest scripts
        run: cp -rf /share-libs/* app/${{ inputs.itest_path }}/
      - name: run Itest
        run: scripts/Itest.sh
        working-directory: app/${{ inputs.itest_path }}
      - name: Publishing Test Report & logs
        uses: actions/upload-artifact@v2
        with:
          name: reporting
          path: app/${{ inputs.itest_path }}/reporting