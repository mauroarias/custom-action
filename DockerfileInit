FROM mcr.microsoft.com/dotnet/sdk:6.0 AS migration
ARG MIGRATION_PATH=""
ARG INTEGRATION_TEST_PATH
COPY ${MIGRATION_PATH} /src
COPY ${INTEGRATION_TEST_PATH}share-qa-libs/scripts/Migration.sh "/src"
ENV PATH $PATH:/root/.dotnet/tools
WORKDIR "/src"
RUN ./Migration.sh ${MIGRATION_PATH}

FROM mcr.microsoft.com/dotnet/sdk:6.0 as initrunner
ARG INTEGRATION_TEST_PATH
RUN apt-get update
RUN apt-get install -y postgresql-client jq
RUN apt-get clean
COPY ${INTEGRATION_TEST_PATH}scripts/* /scripts/
COPY ${INTEGRATION_TEST_PATH}share-qa-libs/scripts/* /scripts/
COPY --from=migration /src/dbMigration* /migration/
WORKDIR "/"
CMD ["/scripts/Init.sh"]